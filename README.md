# Tired LSM Tree

A simple tired compacting Log-Structured Merge Tree(LSM Tree) Ruby implementation which is inspired by [cs265-lsm-tree](https://github.com/jackdent/cs265-lsm-tree).

## Data Structures

![Screen Shot 2022-03-28 at 6 02 48 PM](https://user-images.githubusercontent.com/3775525/160375354-323955d2-c38c-4b6a-a9dc-4c331dd125fa.png)

![Screen Shot 2022-03-28 at 6 09 07 PM](https://user-images.githubusercontent.com/3775525/160376303-4474a928-c1f7-4f69-8958-932d33264a62.png)

## Operations

`LSM::LSMTree#put` is for writing key value pair into DB.

`LSM::LSMTree#get` is for query key into DB.

### Demo

Entry will be inserted into memtable first if the memtable is not full.

![Screen Shot 2022-03-28 at 6 41 03 PM](https://user-images.githubusercontent.com/3775525/160381373-a7af286d-a2c6-4046-8084-68febccd6c30.png)


When the memtable is full, if we want to insert one more entry, DB will write the memtable to disk.

![Screen Shot 2022-03-28 at 6 41 27 PM](https://user-images.githubusercontent.com/3775525/160381442-4246a69e-3a28-4604-945f-18908e98b124.png)

If level 0 is full, when we want to add one more sstable in level 0, DB will merge all level0's sstables into a big sstable, then the big sstable will be written into level 1.

![Screen Shot 2022-03-28 at 6 41 55 PM](https://user-images.githubusercontent.com/3775525/160381528-e1d40db4-69dc-461d-8a1d-ae126f0a7b20.png)

This demo can be generated by the `./bin/demo` script.

# Status
## Current Status
Basic implementation.

## Future Plan
- Crash Recovery
- Benchmark and Optimization
  - use skip list/AVL tree for Memtable
  - mmap
  - paralle
  - read disk ahead
  - ...
- Leveled Compaction Strategy
